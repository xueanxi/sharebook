# 提示词生成功能使用说明

## 功能概述

新增的提示词生成功能可以读取已生成的章节故事板JSON文件，提取场景分镜、旁白和环境氛围等信息，生成每章所有画面的英文提示词和中文旁白，并将结果保存到`data/storyboards_prompt`目录。

## 文件结构

- `src/services/novel_to_comic/prompt_generator.py` - 提示词生成器核心实现
- `src/services/novel_to_comic/test_prompt_generator.py` - 测试脚本
- `src/services/novel_to_comic/core/workflow.py` - 已更新的工作流，集成了提示词生成功能

## 使用方法

### 方法1：直接使用提示词生成器

```python
from src.services.novel_to_comic.prompt_generator import PromptGenerator

# 创建提示词生成器
generator = PromptGenerator()

# 处理所有章节
generator.process_all_chapters()

# 或处理单个章节
generator.process_chapter("第二十八章.json")
```

### 方法2：通过工作流使用

```python
from src.services.novel_to_comic.core.workflow import NovelToComicWorkflow

# 创建工作流
workflow = NovelToComicWorkflow()

# 为所有章节生成提示词
prompt_files = workflow.generate_prompts_for_all_chapters()

# 或为单个章节生成提示词
prompt_file = workflow.generate_prompts_for_chapter("第二十八章.json")
```

### 方法3：运行测试脚本

```bash
cd d:\work\code\python\sharebook2
python src/services/novel_to_comic/test_prompt_generator.py
```

## 输出格式

生成的提示词文件将保存在`data/storyboards_prompt`目录下，每个章节一个JSON文件，文件名格式为`第X章_prompts.json`。

每个提示词文件包含以下内容：

```json
{
  "chapter_number": "28",
  "source_file": "第二十八章.json",
  "total_prompts": 10,
  "prompts": [
    {
      "scene_index": 1,
      "narrative_index": 1,
      "english_prompt": "battle scene, intense fighting between warriors, setting: ancient battlefield, characters: Zhang Wu, muscular build, determined expression, wielding a long sword, camera angle: medium shot, composition: dynamic action pose, lighting: dramatic, color scheme: warm tones, mood: tense, high quality, detailed, masterpiece",
      "chinese_narration": "张武手持长剑，在古战场上与敌人激烈战斗，他的眼神坚定，肌肉紧绷，展现出无畏的勇气。"
    },
    ...
  ]
}
```

## 提示词生成逻辑

英文提示词的生成基于以下信息：

1. 场景类型和描述
2. 视觉叙述描述
3. 环境设置
4. 角色信息（外貌、表情、动作）
5. 构图和镜头角度
6. 光照和色彩方案
7. 氛围和情绪
8. 质量修饰词（high quality, detailed, masterpiece）

中文旁白直接从视觉叙述中提取，保持原始内容不变。

## 注意事项

1. 确保已存在`data/storyboards`目录下的章节故事板JSON文件
2. 提示词生成器会自动创建`data/storyboards_prompt`输出目录
3. 如果输出文件已存在，将会被覆盖
4. 生成的英文提示词适合用于Stable Diffusion等文生图模型